# ------------------------------------------------------------------------------------------------
# Dockerfile: api_src ν΄λ” κµ¬μ΅° μ μ§€ λ° κ²½λ΅ μμ •
# ------------------------------------------------------------------------------------------------
FROM dannymaq/mmaction:v6-nano

# 1. API μ„λ²„ νμΌμ„ /mmaction2 ν΄λ” λ‚΄λ¶€λ΅ λ³µμ‚¬ν•©λ‹λ‹¤.
#    => μ»¨ν…μ΄λ„ λ‚΄λ¶€ κ²½λ΅: /mmaction2/api_src/
COPY ./api_src /mmaction2/api_src/ 

# π’¥ μ¶”κ°€: μ²΄ν¬ν¬μΈνΈ νμΌμ„ μ»¨ν…μ΄λ„ λ‚΄λ¶€μ κ²€μƒ‰ κ²½λ΅λ΅ λ³µμ‚¬
COPY ./api_src/stgcn_70p.pth /mmaction2/api_src/stgcn_70p.pth

# 2. κΈ°λ³Έ μ‘μ—… λ””λ ‰ν† λ¦¬λ¥Ό /mmaction2/api_srcλ΅ λ³€κ²½ν•©λ‹λ‹¤.
#    μ΄μ  λ¨λ“  μƒλ€ κ²½λ΅λ” /mmaction2/api_srcλ¥Ό κΈ°μ¤€μΌλ΅ ν•©λ‹λ‹¤.
WORKDIR /mmaction2/api_src

# 3. API μ‹¤ν–‰μ— ν•„μ”ν• μ¶”κ°€ Python ν¨ν‚¤μ§€λ¥Ό μ„¤μΉν•©λ‹λ‹¤.
#    requirements.txt νμΌμ΄ μ΄μ  /mmaction2/api_src ν΄λ”μ— μμµλ‹λ‹¤.
RUN pip install --no-cache-dir -r /mmaction2/api_src/requirements.txt

# 4. μ»¨ν…μ΄λ„κ°€ API μ„λ²„λ¥Ό μ‹¤ν–‰ν•λ„λ΅ μ„¤μ •ν•©λ‹λ‹¤.
EXPOSE 19031

# 5. μ»¨ν…μ΄λ„ μ‹μ‘ μ‹ API μ„λ²„ μ‹¤ν–‰
#    WORKDIR λ•λ¶„μ— api_server.py νμΌλ§ μ§€μ •ν•λ©΄ λ©λ‹λ‹¤.
CMD ["python", "api_server.py"]